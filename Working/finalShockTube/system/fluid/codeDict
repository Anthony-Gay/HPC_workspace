/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  7
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      codeDict;
} 

HPCFluidP
{
  code
  #{    
    const fvMesh& fluidMesh = db().parent().lookupObject<fvMesh>("fluid");
    const fvMesh& partMesh = db().parent().lookupObject<fvMesh>("particle");

    const volScalarField& pFluid = db().lookupObject<volScalarField>("p");     
    const volScalarField& pFluidOld=pFluid.oldTime();

    const volVectorField& momentum = partMesh.lookupObject<volVectorField>("momentum");
    const volScalarField& rhoN = partMesh.lookupObject<volScalarField>("rhoN");
    const volScalarField& rhoM = partMesh.lookupObject<volScalarField>("rhoM");
    const volScalarField& linearKE = partMesh.lookupObject<volScalarField>("linearKE");
    const volScalarField& internalE = partMesh.lookupObject<volScalarField>("internalE");
    const volScalarField& iDof = partMesh.lookupObject<volScalarField>("iDof");

 
            

  volVectorField U
    (
        IOobject
        (
            "UPart",
            partMesh.time().timeName(),
            partMesh,
            IOobject::NO_READ
        ),
        momentum/rhoM
    );

  volScalarField overallT
    (
        IOobject
        (
            "overallT",
            partMesh.time().timeName(),
            partMesh,
            IOobject::NO_READ
        ),
        2.0/(physicoChemical::k.value()*(3.0*rhoN + iDof))
      *(linearKE - 0.5*rhoM*(U & U) + internalE)
    );

  volScalarField translationalT
    (
        IOobject
        (
            "TTranslationalPart",
            partMesh.time().timeName(),
            partMesh,
            IOobject::NO_READ
        ),
        2.0/(3.0*physicoChemical::k.value()*rhoN)*(linearKE - 0.5*rhoM*(U & U))
    );

    volScalarField pParticle
    (
        IOobject
        (
            "pParticle",
            partMesh.time().timeName(),
            partMesh,
            IOobject::NO_READ
        ),
        physicoChemical::k.value()*rhoN*translationalT //https://courses.lumenlearning.com/physics/chapter/13-3-the-ideal-gas-law/
    );
    
    const label fluidIdx=fluidMesh.nCells()-1;
    const label particleIdx=0;
    const scalar w=0.4; 
    
    Info<< nl << "FLUID PRESSURE BC";
    Info<< nl << "Particle pressure formula 1: " << pParticle[particleIdx];
    Info<< nl << "Particle pressure formula 2: " << physicoChemical::k.value()*rhoN[particleIdx]*translationalT[particleIdx];
    Info<< nl << "Particle pressure from rhoM: " << rhoM[particleIdx]*overallT[particleIdx]*296.8;
        Info<< nl << "Particle pressure from rhoM T_trans: " << rhoM[particleIdx]*translationalT[particleIdx]*296.8;
    Info<< nl << "Particle overallT: " << overallT[particleIdx];
    Info<< nl << "Particle TRans T: " << translationalT[particleIdx] << nl;
  

    operator==((1-w)*pFluidOld[fluidIdx]+w*(0.5*pFluid[fluidIdx]+0.5*pParticle[particleIdx])); 

  #};
  
codeInclude
#{
  #include "constants.H"
  using namespace Foam::constant;
#};
}
   

HPCFluidT
{
  code
  #{    
    const fvMesh& fluidMesh = db().parent().lookupObject<fvMesh>("fluid");
    const fvMesh& partMesh = db().parent().lookupObject<fvMesh>("particle");

    const volScalarField& TFluid = db().lookupObject<volScalarField>("T");     
    const volScalarField& TFluidOld=TFluid.oldTime();

    const volVectorField& momentum = partMesh.lookupObject<volVectorField>("momentum");
    const volScalarField& rhoN = partMesh.lookupObject<volScalarField>("rhoN");
    const volScalarField& rhoM = partMesh.lookupObject<volScalarField>("rhoM");
    const volScalarField& linearKE = partMesh.lookupObject<volScalarField>("linearKE");
    const volScalarField& internalE = partMesh.lookupObject<volScalarField>("internalE");
    const volScalarField& iDof = partMesh.lookupObject<volScalarField>("iDof");

    volVectorField U
            (
                IOobject
                (
                    "U",
                    partMesh.time().timeName(),
                    partMesh,
                    IOobject::NO_READ
                ),
                momentum/rhoM
            );
            
volScalarField translationalT
    (
        IOobject
        (
            "TTranslationalPart",
            partMesh.time().timeName(),
            partMesh,
            IOobject::NO_READ
        ),
        2.0/(3.0*physicoChemical::k.value()*rhoN)*(linearKE - 0.5*rhoM*(U & U))
    );

    volScalarField overallT
            (
                IOobject
                (
                    "overallT",
                    partMesh.time().timeName(),
                    partMesh,
                    IOobject::NO_READ
                ),
                2.0/(physicoChemical::k.value()*(3.0*rhoN + iDof))
              *(linearKE - 0.5*rhoM*(U & U) + internalE)
            );


    const label fluidIdx=fluidMesh.nCells()-1;
    const label particleIdx=0;
    const scalar w=0.4; 
    
     Info<< nl << "FLUID TEMP BC";
    Info<< nl << "Particle overallT: " << overallT[particleIdx];
    Info<< nl << "Particle TRans T: " << translationalT[particleIdx];
    Info<< nl << "Fluid Temp: " << TFluid[fluidIdx] << nl;

    operator==((1-w)*TFluidOld[fluidIdx]+w*(0.5*TFluid[fluidIdx]+0.5*translationalT[particleIdx])); 

  #};
  codeInclude
#{
  #include "constants.H"
  using namespace Foam::constant;
#};
}

HPCFluidU
{
  code
  #{    
    const fvMesh& fluidMesh = db().parent().lookupObject<fvMesh>("fluid");
    const fvMesh& partMesh = db().parent().lookupObject<fvMesh>("particle");

    const volVectorField& UFluid = db().lookupObject<volVectorField>("U");     
    const volVectorField& UFluidOld=UFluid.oldTime();
   
    const volVectorField& momentum = partMesh.lookupObject<volVectorField>("momentum");
    const volScalarField& rhoM = partMesh.lookupObject<volScalarField>("rhoM");

    volVectorField U
            (
                IOobject
                (
                    "U",
                    partMesh.time().timeName(),
                    partMesh,
                    IOobject::NO_READ
                ),
                momentum/rhoM
            );

    const label fluidIdx=fluidMesh.nCells()-1;
    const label particleIdx=0;
    const scalar w=0.4; 
    
    Info<< nl << "FLUID VEL BC";
    Info<< nl << "Particle velocity: " << U[particleIdx];
        Info<< nl << "Fluid velocity : " << UFluid[fluidIdx];

    operator==((1-w)*UFluidOld[fluidIdx]+w*(0.5*UFluid[fluidIdx]+0.5*U[particleIdx])); 

  #};
}
