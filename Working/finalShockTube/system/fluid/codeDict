/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  7
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      codeDict;
} 

HPCFluid
{
  code
  #{
    const fvMesh& fluidMeshRef = patch().boundaryMesh().mesh();
    const fvMesh& partMeshRef = db().parent().lookupObject<fvMesh>("particle");

    const volScalarField& pFluid = db().lookupObject<volScalarField>("p");     
    const volScalarField& pFluidOld=pFluid.oldTime();

    const volVectorField& momentumRef = partMeshRef.lookupObject<volVectorField>("momentum");
    const volScalarField& rhoNRef = partMeshRef.lookupObject<volScalarField>("rhoN");
    const volScalarField& rhoMRef = partMeshRef.lookupObject<volScalarField>("rhoM");
    const volScalarField& linearKERef = partMeshRef.lookupObject<volScalarField>("linearKE");

    const volVectorField& U_=momentumRef/rhoMRef;
    const volScalarField& translationalT_=2.0/(3.0*physicoChemical::k.value()*rhoNRef)*(linearKERef - 0.5*rhoMRef*(U_ & U_));
    const volScalarField& pParticle=physicoChemical::k.value()*rhoNRef*translationalT_;    

    const label fluidIdx=fluidMeshRef.nCells();
    const label particleIdx=1;
    const scalar w=0.75; 

    operator==((1-w)*pFluidOld[fluidIdx]+w*(0.5*pFluid[fluidIdx]+0.5*pParticle[particleIdx])); 
  #};

  codeInclude
#{
  #include "constants.H"
  using namespace Foam::constant;
#};
}
      